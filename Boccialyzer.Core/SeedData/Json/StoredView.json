[
  {
    "proname": "athena_view_issues_for_initiators",
    "sql": "CREATE OR REPLACE VIEW public.athena_view_issues_for_initiators AS SELECT issues.\"Id\", issues.\"Number\", issues.\"CreatedOn\", initiators.\"PersonId\", CASE WHEN NOT issues.\"NotObject\" THEN (( CASE WHEN length(issues.\"StaticLastName\"::text) > 3 THEN \"substring\"(issues.\"StaticLastName\"::text, 1, 3) || '...'::text ELSE ''::text END || CASE WHEN length(issues.\"StaticFirstName\"::text) > 0 THEN (' '::text || \"left\"(issues.\"StaticFirstName\"::text, 1)) || '.'::text ELSE ''::text END) || CASE WHEN length(issues.\"StaticMiddleName\"::text) > 0 THEN (' '::text || \"left\"(issues.\"StaticMiddleName\"::text, 1)) || '.'::text ELSE ''::text END) || CASE WHEN length(issues.\"StaticLastName\"::text) > 0 THEN (' ['::text || issues.\"StaticAliasName\") || ']'::text ELSE ''::text END ELSE 'Не об`єкт'::text END AS \"FullName\", issues.\"NotObject\", ( SELECT COALESCE(sum(sessions.\"Duration\"), 0::bigint) AS \"Duration\" FROM \"Sessions\" sessions WHERE issues.\"Id\" = sessions.\"IssueId\" AND NOT sessions.\"IsPrivacy\") AS \"TotalDuration\" FROM \"Issues\" issues JOIN \"InitiatorToIssues\" initiators ON issues.\"Id\" = initiators.\"IssueId\" JOIN \"IssueStatuses\" status ON issues.\"IssueStatusId\" = status.\"Id\", \"Persons\" persons WHERE NOT issues.\"IsPrivacy\" AND status.\"CanBeAccessedByInitiator\" AND initiators.\"GrantAccess\" AND persons.\"Id\" = initiators.\"PersonId\" GROUP BY issues.\"Id\", initiators.\"PersonId\" ORDER BY issues.\"Number\"; ALTER TABLE public.athena_view_issues_for_initiators OWNER TO postgres; COMMENT ON VIEW public.athena_view_issues_for_initiators IS 'Доступні завдання ініціаторів';"
  },
  {
    "proname": "athena_view_sessions_for_initiator",
    "sql": "CREATE OR REPLACE VIEW public.athena_view_sessions_for_initiator AS SELECT sessions.\"Id\" AS \"Id\", sessions.\"IssueId\" AS \"IssueId\", (SELECT issues.\"Number\" AS \"IssueNumber\" FROM \"Issues\" issues WHERE issues.\"Id\" = sessions.\"IssueId\"), string_agg( btrim(persons.\"LastName\"::text || ' '::text) || btrim(persons.\"FirstName\"::text || ' '::text) || btrim(persons.\"MiddleName\"::text || ' '::text) || (SELECT (' ['::text || pa.\"Name\") || ']'::text FROM \"PersonAliases\" pa, \"Persons\" per WHERE pa.\"PersonId\" = per.\"Id\" AND pa.\"IsDefault\"), ', '::text) AS \"FullName\" , sessions.\"CompletionCause\" , sessions.\"Direction\", sessions.\"DateTimeStamp\", sessions.\"Duration\", sessions.\"InitiatorComment\" , CASE WHEN sessions.\"SessionType\" = 2 THEN sessions.\"TextSms\" WHEN sessions.\"SessionType\" = 3 THEN sessions.\"TextMms\" ELSE NULL::text END AS \"Message\", CASE WHEN length(sessions.\"NumberB\"::text) > 0 THEN sessions.\"NumberB\" ELSE sessions.\"NumberB1\" END AS \"NumberB\", sessions.\"OwnerB\", sessions.\"SessionStatusId\", sessions.\"SessionStatusInitiatorId\", sessions.\"SessionType\", (SELECT (((('[LID: '::text || bs.\"Lid\") || ', CID: '::text) || bs.\"Lid\") || '] '::text) || bs.\"Address\" FROM \"BaseStations\" bs WHERE sessions.\"BaseStationId\" = bs.\"Id\") AS \"BaseStation\" , sessions.\"TextFileLink\", sessions.\"InfoFileLink\", sessions.\"InitiatorRankId\" FROM \"Sessions\" sessions LEFT JOIN \"Interlocutors\" il ON sessions.\"Id\" = il.\"SessionId\" LEFT JOIN \"Persons\" persons ON il.\"PersonId\" = persons.\"Id\" WHERE (NOT sessions.\"IsPrivacy\") GROUP BY sessions.\"Id\"; ALTER TABLE public.athena_view_sessions_for_initiator OWNER TO postgres; COMMENT ON VIEW public.athena_view_sessions_for_initiator IS 'Доступні сеанси за завданнями для ініціаторів';"
  },
  {
    "proname": "athena_view_basestation",
    "sql": "CREATE OR REPLACE VIEW public.athena_view_basestation AS SELECT *, (SELECT mobileoperators.\"Name\" FROM \"MobileOperators\" mobileoperators WHERE mobileoperators.\"Id\" = basestations.\"MobileOperatorId\") AS \"MobileOperatorName\" FROM \"BaseStations\" basestations; ALTER TABLE public.athena_view_basestation OWNER TO postgres; COMMENT ON VIEW public.athena_view_basestation IS 'Базові станції';"
  },
  {
    "proname": "athena_view_issues_for_access",
    "sql": "CREATE OR REPLACE VIEW public.athena_view_issues_for_access AS SELECT iss.\"Id\" AS \"IssueId\", iss.\"Number\" AS \"IssueNumber\", iss.\"IssueStatusId\", ini.\"Id\", ini.\"DateFrom\", ini.\"DateTo\", ini.\"PersonId\", ini.\"DocumentId\", doc.\"NumberIn\" AS \"DocumentNumberIn\", doc.\"NumberOut\" AS \"DocumentNumberOut\", doc.\"DateIn\" AS \"DocumentDateIn\", doc.\"DateOut\" AS \"DocumentDateOut\", doc.\"Comment\" AS \"DocumentComment\", ini.\"GrantAccess\", ini.\"IsMain\" FROM \"Issues\" iss JOIN \"InitiatorToIssues\" ini ON iss.\"Id\" = ini.\"IssueId\" LEFT JOIN \"Documents\" doc ON doc.\"Id\" = ini.\"DocumentId\" JOIN \"IssueStatuses\" status ON iss.\"IssueStatusId\" = status.\"Id\" WHERE NOT iss.\"IsPrivacy\" AND status.\"CanBeAccessedByInitiator\"; ALTER TABLE public.athena_view_issues_for_access OWNER TO postgres; COMMENT ON VIEW public.athena_view_issues_for_access IS 'Завдання для надання доступу';"
  }
]
